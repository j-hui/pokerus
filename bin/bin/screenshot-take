#!/usr/bin/env bash

set -euf

mode="select"
filepath=~/Pictures/screenshots
filename=screenshot-%Y-%m-%d-%H-%M-%S.png
cmd='notify-send "Captured screenshot" $f'

usage () {
    echo "$0 [--fullscreen|-f] [filename]"
}

while [ "$#" -gt 0 ]; do
    case "$1" in
    --fullscreen|-f)
        mode="fullscreen"
        shift
        ;;
    *)
        break
        ;;
    esac
done

if [ "$#" -gt 0 ]; then
    filename = "$1"
    shift
fi

if [ "$#" -gt 0 ]; then
    echo "Unrecognized arguments: $@"
    usage
    exit 1
fi

mkdir -p "$filepath"

case "$mode" in
    fullscreen)
        scrot --focused "${filepath}/${filename}" -e "$cmd"
        ;;
    *)  # assume select
        # NOTE: without the sleep scrot crashes with:
        #   giblib error: couldn't grab keyboard:Resource temporarily unavailable
        sleep 0.3
        scrot --select --freeze "${filepath}/${filename}" -e "$cmd"
        ;;
esac
